"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _pluginBase = _interopRequireDefault(require("@electron-forge/plugin-base"));

var _debug = _interopRequireDefault(require("debug"));

var _requireSearch = _interopRequireDefault(require("./require-search"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const d = (0, _debug.default)('electron-forge:plugins');

class PluginInterface {
  constructor(dir, forgeConfig) {
    _defineProperty(this, "plugins", void 0);

    _defineProperty(this, "config", void 0);

    this.plugins = forgeConfig.plugins.map(plugin => {
      if (plugin.__isElectronForgePlugin) {
        return plugin;
      }

      if (Array.isArray(plugin)) {
        if (typeof plugin[0] !== 'string') {
          throw `Expected plugin[0] to be a string but found ${plugin[0]}`;
        }

        let opts = {};
        if (typeof plugin[1] !== 'undefined') opts = plugin[1];
        const Plugin = (0, _requireSearch.default)(dir, [plugin[0]]);

        if (!Plugin) {
          throw `Could not find module with name: ${plugin[0]}`;
        }

        return new Plugin(opts);
      }

      throw `Expected plugin to either be a plugin instance or [string, object] but found ${plugin}`; // eslint-disable-line
    }); // Fix linting

    this.config = null;
    Object.defineProperty(this, 'config', {
      value: forgeConfig,
      enumerable: false,
      configurable: false,
      writable: false
    });
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = this.plugins[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        const plugin = _step.value;
        plugin.init(dir, forgeConfig);
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return != null) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    this.triggerHook = this.triggerHook.bind(this);
    this.overrideStartLogic = this.overrideStartLogic.bind(this);
  }

  triggerHook(hookName, hookArgs) {
    var _this = this;

    return _asyncToGenerator(function* () {
      var _iteratorNormalCompletion2 = true;
      var _didIteratorError2 = false;
      var _iteratorError2 = undefined;

      try {
        for (var _iterator2 = _this.plugins[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
          const plugin = _step2.value;

          if (typeof plugin.getHook === 'function') {
            const hook = plugin.getHook(hookName);
            if (hook) yield hook(_this.config, ...hookArgs);
          }
        }
      } catch (err) {
        _didIteratorError2 = true;
        _iteratorError2 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
            _iterator2.return();
          }
        } finally {
          if (_didIteratorError2) {
            throw _iteratorError2;
          }
        }
      }
    })();
  }

  triggerMutatingHook(hookName, item) {
    var _this2 = this;

    return _asyncToGenerator(function* () {
      var _iteratorNormalCompletion3 = true;
      var _didIteratorError3 = false;
      var _iteratorError3 = undefined;

      try {
        for (var _iterator3 = _this2.plugins[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
          const plugin = _step3.value;

          if (typeof plugin.getHook === 'function') {
            const hook = plugin.getHook(hookName);

            if (hook) {
              item = yield hook(_this2.config, item);
            }
          }
        }
      } catch (err) {
        _didIteratorError3 = true;
        _iteratorError3 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion3 && _iterator3.return != null) {
            _iterator3.return();
          }
        } finally {
          if (_didIteratorError3) {
            throw _iteratorError3;
          }
        }
      }

      return item;
    })();
  }

  overrideStartLogic(opts) {
    var _this3 = this;

    return _asyncToGenerator(function* () {
      let newStartFn;
      const claimed = [];
      var _iteratorNormalCompletion4 = true;
      var _didIteratorError4 = false;
      var _iteratorError4 = undefined;

      try {
        for (var _iterator4 = _this3.plugins[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
          const plugin = _step4.value;

          if (typeof plugin.startLogic === 'function' && plugin.startLogic !== _pluginBase.default.prototype.startLogic) {
            claimed.push(plugin.name);
            newStartFn = plugin.startLogic;
          }
        }
      } catch (err) {
        _didIteratorError4 = true;
        _iteratorError4 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion4 && _iterator4.return != null) {
            _iterator4.return();
          }
        } finally {
          if (_didIteratorError4) {
            throw _iteratorError4;
          }
        }
      }

      if (claimed.length > 1) throw `Multiple plugins tried to take control of the start command, please remove one of them\n --> ${claimed.join(', ')}`;

      if (claimed.length === 1 && newStartFn) {
        d(`plugin: "${claimed[0]}" has taken control of the start command`);
        return yield newStartFn(opts);
      }

      return false;
    })();
  }

}

exports.default = PluginInterface;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL3BsdWdpbi1pbnRlcmZhY2UudHMiXSwibmFtZXMiOlsiZCIsIlBsdWdpbkludGVyZmFjZSIsImNvbnN0cnVjdG9yIiwiZGlyIiwiZm9yZ2VDb25maWciLCJwbHVnaW5zIiwibWFwIiwicGx1Z2luIiwiX19pc0VsZWN0cm9uRm9yZ2VQbHVnaW4iLCJBcnJheSIsImlzQXJyYXkiLCJvcHRzIiwiUGx1Z2luIiwiY29uZmlnIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJ2YWx1ZSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsImluaXQiLCJ0cmlnZ2VySG9vayIsImJpbmQiLCJvdmVycmlkZVN0YXJ0TG9naWMiLCJob29rTmFtZSIsImhvb2tBcmdzIiwiZ2V0SG9vayIsImhvb2siLCJ0cmlnZ2VyTXV0YXRpbmdIb29rIiwiaXRlbSIsIm5ld1N0YXJ0Rm4iLCJjbGFpbWVkIiwic3RhcnRMb2dpYyIsIlBsdWdpbkJhc2UiLCJwcm90b3R5cGUiLCJwdXNoIiwibmFtZSIsImxlbmd0aCIsImpvaW4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUdBOztBQUdBOzs7Ozs7Ozs7O0FBRUEsTUFBTUEsQ0FBQyxHQUFHLG9CQUFNLHdCQUFOLENBQVY7O0FBRWUsTUFBTUMsZUFBTixDQUF1RDtBQUlwRUMsRUFBQUEsV0FBVyxDQUFDQyxHQUFELEVBQWNDLFdBQWQsRUFBd0M7QUFBQTs7QUFBQTs7QUFDakQsU0FBS0MsT0FBTCxHQUFlRCxXQUFXLENBQUNDLE9BQVosQ0FBb0JDLEdBQXBCLENBQXlCQyxNQUFELElBQVk7QUFDakQsVUFBS0EsTUFBRCxDQUF5QkMsdUJBQTdCLEVBQXNEO0FBQ3BELGVBQU9ELE1BQVA7QUFDRDs7QUFFRCxVQUFJRSxLQUFLLENBQUNDLE9BQU4sQ0FBY0gsTUFBZCxDQUFKLEVBQTJCO0FBQ3pCLFlBQUksT0FBT0EsTUFBTSxDQUFDLENBQUQsQ0FBYixLQUFxQixRQUF6QixFQUFt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O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBU3RELGFBQU9BLElBQVA7QUFUc0Q7QUFVdkQ7O0FBRUtOLEVBQUFBLGtCQUFOLENBQXlCWixJQUF6QixFQUE2QztBQUFBOztBQUFBO0FBQzNDLFVBQUltQixVQUFKO0FBQ0EsWUFBTUMsT0FBTyxHQUFHLEVBQWhCO0FBRjJDO0FBQUE7QUFBQTs7QUFBQTtBQUczQyw4QkFBcUIsTUFBSSxDQUFDMUIsT0FBMUIsbUlBQW1DO0FBQUEsZ0JBQXhCRSxNQUF3Qjs7QUFDakMsY0FBSSxPQUFPQSxNQUFNLENBQUN5QixVQUFkLEtBQTZCLFVBQTdCLElBQTJDekIsTUFBTSxDQUFDeUIsVUFBUCxLQUFzQkMsb0JBQVdDLFNBQVgsQ0FBcUJGLFVBQTFGLEVBQXNHO0FBQ3BHRCxZQUFBQSxPQUFPLENBQUNJLElBQVIsQ0FBYTVCLE1BQU0sQ0FBQzZCLElBQXBCO0FBQ0FOLFlBQUFBLFVBQVUsR0FBR3ZCLE1BQU0sQ0FBQ3lCLFVBQXBCO0FBQ0Q7QUFDRjtBQVIwQztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOztBQVMzQyxVQUFJRCxPQUFPLENBQUNNLE1BQVIsR0FBaUIsQ0FBckIsRUFBd0IsTUFBTyxnR0FBK0ZOLE9BQU8sQ0FBQ08sSUFBUixDQUFhLElBQWIsQ0FBbUIsRUFBekg7O0FBQ3hCLFVBQUlQLE9BQU8sQ0FBQ00sTUFBUixLQUFtQixDQUFuQixJQUF3QlAsVUFBNUIsRUFBd0M7QUFDdEM5QixRQUFBQSxDQUFDLENBQUUsWUFBVytCLE9BQU8sQ0FBQyxDQUFELENBQUksMENBQXhCLENBQUQ7QUFDQSxxQkFBYUQsVUFBVSxDQUFDbkIsSUFBRCxDQUF2QjtBQUNEOztBQUNELGFBQU8sS0FBUDtBQWQyQztBQWU1Qzs7QUE3RW1FIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFBsdWdpbkJhc2UgZnJvbSAnQGVsZWN0cm9uLWZvcmdlL3BsdWdpbi1iYXNlJztcbmltcG9ydCB7IElGb3JnZVBsdWdpbkludGVyZmFjZSwgRm9yZ2VDb25maWcsIElGb3JnZVBsdWdpbiB9IGZyb20gJ0BlbGVjdHJvbi1mb3JnZS9zaGFyZWQtdHlwZXMnO1xuaW1wb3J0IHsgQ2hpbGRQcm9jZXNzIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgZGVidWcgZnJvbSAnZGVidWcnO1xuXG5pbXBvcnQgeyBTdGFydE9wdGlvbnMgfSBmcm9tICcuLi9hcGknO1xuaW1wb3J0IHJlcXVpcmVTZWFyY2ggZnJvbSAnLi9yZXF1aXJlLXNlYXJjaCc7XG5cbmNvbnN0IGQgPSBkZWJ1ZygnZWxlY3Ryb24tZm9yZ2U6cGx1Z2lucycpO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQbHVnaW5JbnRlcmZhY2UgaW1wbGVtZW50cyBJRm9yZ2VQbHVnaW5JbnRlcmZhY2Uge1xuICBwcml2YXRlIHBsdWdpbnM6IElGb3JnZVBsdWdpbltdO1xuICBwcml2YXRlIGNvbmZpZzogRm9yZ2VDb25maWc7XG5cbiAgY29uc3RydWN0b3IoZGlyOiBzdHJpbmcsIGZvcmdlQ29uZmlnOiBGb3JnZUNvbmZpZykge1xuICAgIHRoaXMucGx1Z2lucyA9IGZvcmdlQ29uZmlnLnBsdWdpbnMubWFwKChwbHVnaW4pID0+IHtcbiAgICAgIGlmICgocGx1Z2luIGFzIElGb3JnZVBsdWdpbikuX19pc0VsZWN0cm9uRm9yZ2VQbHVnaW4pIHtcbiAgICAgICAgcmV0dXJuIHBsdWdpbjtcbiAgICAgIH1cblxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGx1Z2luKSkge1xuICAgICAgICBpZiAodHlwZW9mIHBsdWdpblswXSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICB0aHJvdyBgRXhwZWN0ZWQgcGx1Z2luWzBdIHRvIGJlIGEgc3RyaW5nIGJ1dCBmb3VuZCAke3BsdWdpblswXX1gO1xuICAgICAgICB9XG4gICAgICAgIGxldCBvcHRzID0ge307XG4gICAgICAgIGlmICh0eXBlb2YgcGx1Z2luWzFdICE9PSAndW5kZWZpbmVkJykgb3B0cyA9IHBsdWdpblsxXTtcbiAgICAgICAgY29uc3QgUGx1Z2luID0gcmVxdWlyZVNlYXJjaDxhbnk+KGRpciwgW3BsdWdpblswXV0pO1xuICAgICAgICBpZiAoIVBsdWdpbikge1xuICAgICAgICAgIHRocm93IGBDb3VsZCBub3QgZmluZCBtb2R1bGUgd2l0aCBuYW1lOiAke3BsdWdpblswXX1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUGx1Z2luKG9wdHMpO1xuICAgICAgfVxuICAgICAgdGhyb3cgYEV4cGVjdGVkIHBsdWdpbiB0byBlaXRoZXIgYmUgYSBwbHVnaW4gaW5zdGFuY2Ugb3IgW3N0cmluZywgb2JqZWN0XSBidXQgZm91bmQgJHtwbHVnaW59YDsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAgIH0pO1xuICAgIC8vIEZpeCBsaW50aW5nXG4gICAgdGhpcy5jb25maWcgPSBudWxsIGFzIGFueTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ2NvbmZpZycsIHtcbiAgICAgIHZhbHVlOiBmb3JnZUNvbmZpZyxcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSxcbiAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICB9KTtcblxuICAgIGZvciAoY29uc3QgcGx1Z2luIG9mIHRoaXMucGx1Z2lucykge1xuICAgICAgcGx1Z2luLmluaXQoZGlyLCBmb3JnZUNvbmZpZyk7XG4gICAgfVxuXG4gICAgdGhpcy50cmlnZ2VySG9vayA9IHRoaXMudHJpZ2dlckhvb2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm92ZXJyaWRlU3RhcnRMb2dpYyA9IHRoaXMub3ZlcnJpZGVTdGFydExvZ2ljLmJpbmQodGhpcyk7XG4gIH1cblxuICBhc3luYyB0cmlnZ2VySG9vayhob29rTmFtZTogc3RyaW5nLCBob29rQXJnczogYW55W10pIHtcbiAgICBmb3IgKGNvbnN0IHBsdWdpbiBvZiB0aGlzLnBsdWdpbnMpIHtcbiAgICAgIGlmICh0eXBlb2YgcGx1Z2luLmdldEhvb2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgY29uc3QgaG9vayA9IHBsdWdpbi5nZXRIb29rKGhvb2tOYW1lKTtcbiAgICAgICAgaWYgKGhvb2spIGF3YWl0IGhvb2sodGhpcy5jb25maWcsIC4uLmhvb2tBcmdzKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhc3luYyB0cmlnZ2VyTXV0YXRpbmdIb29rPFQ+KGhvb2tOYW1lOiBzdHJpbmcsIGl0ZW06IFQpIHtcbiAgICBmb3IgKGNvbnN0IHBsdWdpbiBvZiB0aGlzLnBsdWdpbnMpIHtcbiAgICAgIGlmICh0eXBlb2YgcGx1Z2luLmdldEhvb2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgY29uc3QgaG9vayA9IHBsdWdpbi5nZXRIb29rKGhvb2tOYW1lKTtcbiAgICAgICAgaWYgKGhvb2spIHtcbiAgICAgICAgICBpdGVtID0gYXdhaXQgaG9vayh0aGlzLmNvbmZpZywgaXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGl0ZW07XG4gIH1cblxuICBhc3luYyBvdmVycmlkZVN0YXJ0TG9naWMob3B0czogU3RhcnRPcHRpb25zKSB7XG4gICAgbGV0IG5ld1N0YXJ0Rm47XG4gICAgY29uc3QgY2xhaW1lZCA9IFtdO1xuICAgIGZvciAoY29uc3QgcGx1Z2luIG9mIHRoaXMucGx1Z2lucykge1xuICAgICAgaWYgKHR5cGVvZiBwbHVnaW4uc3RhcnRMb2dpYyA9PT0gJ2Z1bmN0aW9uJyAmJiBwbHVnaW4uc3RhcnRMb2dpYyAhPT0gUGx1Z2luQmFzZS5wcm90b3R5cGUuc3RhcnRMb2dpYykge1xuICAgICAgICBjbGFpbWVkLnB1c2gocGx1Z2luLm5hbWUpO1xuICAgICAgICBuZXdTdGFydEZuID0gcGx1Z2luLnN0YXJ0TG9naWM7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChjbGFpbWVkLmxlbmd0aCA+IDEpIHRocm93IGBNdWx0aXBsZSBwbHVnaW5zIHRyaWVkIHRvIHRha2UgY29udHJvbCBvZiB0aGUgc3RhcnQgY29tbWFuZCwgcGxlYXNlIHJlbW92ZSBvbmUgb2YgdGhlbVxcbiAtLT4gJHtjbGFpbWVkLmpvaW4oJywgJyl9YDtcbiAgICBpZiAoY2xhaW1lZC5sZW5ndGggPT09IDEgJiYgbmV3U3RhcnRGbikge1xuICAgICAgZChgcGx1Z2luOiBcIiR7Y2xhaW1lZFswXX1cIiBoYXMgdGFrZW4gY29udHJvbCBvZiB0aGUgc3RhcnQgY29tbWFuZGApO1xuICAgICAgcmV0dXJuIGF3YWl0IG5ld1N0YXJ0Rm4ob3B0cyk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuIl19