"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _asyncOra = require("@electron-forge/async-ora");

var _electronRebuild = _interopRequireDefault(require("electron-rebuild"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

var _default =
/*#__PURE__*/
function () {
  var _ref = _asyncToGenerator(function* (buildPath, electronVersion, platform, arch, config = {}) {
    yield (0, _asyncOra.asyncOra)('Preparing native dependencies',
    /*#__PURE__*/
    function () {
      var _ref2 = _asyncToGenerator(function* (rebuildSpinner) {
        const rebuilder = (0, _electronRebuild.default)(Object.assign({}, config, {
          buildPath,
          electronVersion,
          arch
        }));
        const lifecycle = rebuilder.lifecycle;
        let found = 0;
        let done = 0;

        const redraw = () => {
          rebuildSpinner.text = `Preparing native dependencies: ${done} / ${found}`; // eslint-disable-line
        };

        lifecycle.on('module-found', () => {
          found += 1;
          redraw();
        });
        lifecycle.on('module-done', () => {
          done += 1;
          redraw();
        });
        yield rebuilder;
      });

      return function (_x5) {
        return _ref2.apply(this, arguments);
      };
    }());
  });

  return function (_x, _x2, _x3, _x4) {
    return _ref.apply(this, arguments);
  };
}();

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL3JlYnVpbGQudHMiXSwibmFtZXMiOlsiYnVpbGRQYXRoIiwiZWxlY3Ryb25WZXJzaW9uIiwicGxhdGZvcm0iLCJhcmNoIiwiY29uZmlnIiwicmVidWlsZFNwaW5uZXIiLCJyZWJ1aWxkZXIiLCJPYmplY3QiLCJhc3NpZ24iLCJsaWZlY3ljbGUiLCJmb3VuZCIsImRvbmUiLCJyZWRyYXciLCJ0ZXh0Iiwib24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUdBOzs7Ozs7Ozs7OzsrQkFHZSxXQUNiQSxTQURhLEVBRWJDLGVBRmEsRUFHYkMsUUFIYSxFQUliQyxJQUphLEVBS2JDLE1BQStCLEdBQUcsRUFMckIsRUFNVjtBQUNILFVBQU0sd0JBQVMsK0JBQVQ7QUFBQTtBQUFBO0FBQUEsb0NBQTBDLFdBQU9DLGNBQVAsRUFBMEI7QUFDeEUsY0FBTUMsU0FBUyxHQUFHLDhCQUFRQyxNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCSixNQUFsQixFQUEwQjtBQUNsREosVUFBQUEsU0FEa0Q7QUFFbERDLFVBQUFBLGVBRmtEO0FBR2xERSxVQUFBQTtBQUhrRCxTQUExQixDQUFSLENBQWxCO0FBRHdFLGNBTWhFTSxTQU5nRSxHQU1sREgsU0FOa0QsQ0FNaEVHLFNBTmdFO0FBUXhFLFlBQUlDLEtBQUssR0FBRyxDQUFaO0FBQ0EsWUFBSUMsSUFBSSxHQUFHLENBQVg7O0FBRUEsY0FBTUMsTUFBTSxHQUFHLE1BQU07QUFDbkJQLFVBQUFBLGNBQWMsQ0FBQ1EsSUFBZixHQUF1QixrQ0FBaUNGLElBQUssTUFBS0QsS0FBTSxFQUF4RSxDQURtQixDQUN3RDtBQUM1RSxTQUZEOztBQUlBRCxRQUFBQSxTQUFTLENBQUNLLEVBQVYsQ0FBYSxjQUFiLEVBQTZCLE1BQU07QUFBRUosVUFBQUEsS0FBSyxJQUFJLENBQVQ7QUFBWUUsVUFBQUEsTUFBTTtBQUFLLFNBQTVEO0FBQ0FILFFBQUFBLFNBQVMsQ0FBQ0ssRUFBVixDQUFhLGFBQWIsRUFBNEIsTUFBTTtBQUFFSCxVQUFBQSxJQUFJLElBQUksQ0FBUjtBQUFXQyxVQUFBQSxNQUFNO0FBQUssU0FBMUQ7QUFFQSxjQUFNTixTQUFOO0FBQ0QsT0FuQks7O0FBQUE7QUFBQTtBQUFBO0FBQUEsUUFBTjtBQW9CRCxHIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXN5bmNPcmEgfSBmcm9tICdAZWxlY3Ryb24tZm9yZ2UvYXN5bmMtb3JhJztcbmltcG9ydCB7IEZvcmdlUGxhdGZvcm0sIEZvcmdlQXJjaCB9IGZyb20gJ0BlbGVjdHJvbi1mb3JnZS9zaGFyZWQtdHlwZXMnO1xuXG5pbXBvcnQgcmVidWlsZCBmcm9tICdlbGVjdHJvbi1yZWJ1aWxkJztcbmltcG9ydCB7IFJlYnVpbGRPcHRpb25zIH0gZnJvbSAnZWxlY3Ryb24tcmVidWlsZC9saWIvc3JjL3JlYnVpbGQnO1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyAoXG4gIGJ1aWxkUGF0aDogc3RyaW5nLFxuICBlbGVjdHJvblZlcnNpb246IHN0cmluZyxcbiAgcGxhdGZvcm06IEZvcmdlUGxhdGZvcm0sXG4gIGFyY2g6IEZvcmdlQXJjaCxcbiAgY29uZmlnOiBQYXJ0aWFsPFJlYnVpbGRPcHRpb25zPiA9IHt9LFxuKSA9PiB7XG4gIGF3YWl0IGFzeW5jT3JhKCdQcmVwYXJpbmcgbmF0aXZlIGRlcGVuZGVuY2llcycsIGFzeW5jIChyZWJ1aWxkU3Bpbm5lcikgPT4ge1xuICAgIGNvbnN0IHJlYnVpbGRlciA9IHJlYnVpbGQoT2JqZWN0LmFzc2lnbih7fSwgY29uZmlnLCB7XG4gICAgICBidWlsZFBhdGgsXG4gICAgICBlbGVjdHJvblZlcnNpb24sXG4gICAgICBhcmNoLFxuICAgIH0pKTtcbiAgICBjb25zdCB7IGxpZmVjeWNsZSB9ID0gcmVidWlsZGVyO1xuXG4gICAgbGV0IGZvdW5kID0gMDtcbiAgICBsZXQgZG9uZSA9IDA7XG5cbiAgICBjb25zdCByZWRyYXcgPSAoKSA9PiB7XG4gICAgICByZWJ1aWxkU3Bpbm5lci50ZXh0ID0gYFByZXBhcmluZyBuYXRpdmUgZGVwZW5kZW5jaWVzOiAke2RvbmV9IC8gJHtmb3VuZH1gOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gICAgfTtcblxuICAgIGxpZmVjeWNsZS5vbignbW9kdWxlLWZvdW5kJywgKCkgPT4geyBmb3VuZCArPSAxOyByZWRyYXcoKTsgfSk7XG4gICAgbGlmZWN5Y2xlLm9uKCdtb2R1bGUtZG9uZScsICgpID0+IHsgZG9uZSArPSAxOyByZWRyYXcoKTsgfSk7XG5cbiAgICBhd2FpdCByZWJ1aWxkZXI7XG4gIH0pO1xufTtcbiJdfQ==